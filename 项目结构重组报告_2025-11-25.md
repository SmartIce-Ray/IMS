# 项目结构重组报告

**重组日期**: 2025-11-25  
**执行人**: Claude Code  
**版本**: v2.5.0

---

## 一、重组目标

为避免后续工作找不到相关数据与文件文档，按功能分类组织项目文件：
- **数据库文件** → 统一放入 `db/` 目录
- **原始数据** → 统一放入 `source_data/` 目录
- **文档** → 保持在 `docs/` 目录

---

## 二、重组前状态

### 文件分布混乱
- SQL文件、Python脚本、Excel数据、图片文件混杂在根目录
- 难以快速定位数据库相关文件
- 原始数据分散在多个目录

### 存在问题
1. **文件查找困难**: SQL、Python、Excel混在一起
2. **数据管理混乱**: 原始数据分散，难以备份
3. **版本控制复杂**: 需要多个.gitignore规则

---

## 三、重组方案

### 目录命名
- `db/` - Database的缩写，简洁明了
- `source_data/` - 原始数据，语义清晰

### 文件分类

**db/ 目录**（数据库相关）:
- 所有 .sql 文件（schema、data、functions、views等）
- 所有 .py 文件（generate、etl、import脚本）
- sop_validation_*.json（验证文件）
- utils/ 工具脚本目录

**source_data/ 目录**（原始数据）:
- 2025年1-11月22日平台数据/ （美团/点评Excel）
- 各门店截止10月销售数据统计/ （POS销售Excel）
- 野百灵入库单/ （扫描图片）
- *.xlsx 文件（SOP、成本卡、价格表等）

**根目录保留**:
- CLAUDE.md（项目记忆）
- README*.md（项目说明）
- docs/（项目文档）
- frontend/（前端文件）
- .gitignore（排除规则）
- 其他MD配置文件

---

## 四、重组操作

### 4.1 创建目录
```bash
mkdir -p db source_data
```

### 4.2 移动数据库文件
```bash
mv *.sql *.py sop_validation_*.json utils/ db/
```

**移动文件清单**（31个）:
- schema_*.sql (4个)
- data_*.sql (5个)
- functions_*.sql (3个)
- procedures_*.sql (1个)
- triggers_*.sql (1个)
- views_*.sql (2个)
- generate_*.py (3个)
- etl_*.py (2个)
- import_*.py (1个)
- sop_validation_*.json (7个)
- utils/ (1个目录)

### 4.3 移动原始数据
```bash
mv 2025年1-11月22日平台数据/ 各门店截止10月销售数据统计/ 野百灵入库单/ *.xlsx source_data/
```

**移动文件清单**（8个）:
- 2025年1-11月22日平台数据/
- 各门店截止10月销售数据统计/
- 野百灵入库单/
- SOP_basic.xlsx
- 野百灵标准SOP.xlsx
- 野百灵产品标准成本卡.xlsx
- ☺野百灵·贵州酸汤SOP2025.10.14.xlsx
- 原材料价格及规格明细表.xlsx

### 4.4 更新配置文件

**更新 .gitignore**:
```gitignore
# 原始数据目录（包含所有Excel、图片等）
source_data/

# 验证JSON文件（已移至db/目录）
db/sop_validation_*.json
```

**更新 CLAUDE.md**:
- 添加"项目结构"章节
- 更新"文件结构索引"路径（添加db/前缀）
- 添加source_data/目录索引
- 更新版本历史（v2.5.0）

---

## 五、重组后状态

### 目录结构

```
Database/
├── db/                         # 数据库文件（31个文件）
│   ├── schema_*.sql           # 表结构（4个）
│   ├── data_*.sql             # 数据导入（5个）
│   ├── functions_*.sql        # 函数（3个）
│   ├── procedures_*.sql       # 存储过程（1个）
│   ├── triggers_*.sql         # 触发器（1个）
│   ├── views_*.sql            # 视图（2个）
│   ├── generate_*.py          # 生成脚本（3个）
│   ├── etl_*.py               # ETL脚本（2个）
│   ├── import_*.py            # 导入脚本（1个）
│   ├── sop_validation_*.json  # 验证文件（7个）
│   └── utils/                 # 工具脚本
│       └── normalize_name.py
│
├── source_data/                # 原始数据（8项）
│   ├── 2025年1-11月22日平台数据/
│   ├── 各门店截止10月销售数据统计/
│   ├── 野百灵入库单/
│   └── *.xlsx（5个）
│
├── docs/                       # 项目文档（13个）
│   ├── [核心文档]（5个）
│   ├── [专项规则]（2个）
│   ├── [项目管理]（1个）
│   ├── [导航文档]（2个）
│   └── reports/（3个）
│
├── frontend/                   # 前端文件
│
├── CLAUDE.md                   # 项目记忆
├── README*.md                  # 项目说明（3个）
├── .gitignore                  # 排除规则
└── [其他MD文件]（5个）
```

### 文件统计

| 目录 | 文件数 | 说明 |
|-----|--------|------|
| db/ | 31 | 所有数据库相关文件 |
| source_data/ | 8 | 所有原始数据 |
| docs/ | 13 | 所有项目文档 |
| 根目录 | 9 | 配置和说明文件 |
| **总计** | **61** | 文件总数不变 |

---

## 六、重组效果

### 6.1 文件定位快速
✅ **数据库文件**: 全部在 `db/` 目录，快速定位  
✅ **原始数据**: 全部在 `source_data/` 目录，方便备份  
✅ **文档**: 全部在 `docs/` 目录，易于查阅

### 6.2 版本控制简化
✅ **简化.gitignore**: 只需排除 `source_data/` 目录  
✅ **GitHub推送**: 只推送数据库代码和文档，不推送原始数据  
✅ **仓库大小**: 保持在2.6MB左右

### 6.3 后续工作清晰
✅ **数据导入**: 到 `source_data/` 找原始Excel  
✅ **SQL执行**: 到 `db/` 找对应的SQL文件  
✅ **脚本运行**: 到 `db/` 找Python脚本  
✅ **文档查阅**: 到 `docs/` 找相关文档

---

## 七、使用指南

### 快速定位文件

**需要执行SQL?**  
→ 查看 `db/schema_*.sql` 或 `db/data_*.sql`

**需要原始Excel数据?**  
→ 查看 `source_data/` 目录

**需要运行Python脚本?**  
→ 查看 `db/generate_*.py` 或 `db/import_*.py`

**需要查看文档?**  
→ 查看 `docs/` 目录或 `CLAUDE.md`

### 部署新环境

```bash
# 1. 克隆代码（不包含原始数据）
git clone https://github.com/YukikoYoung/SmartIce-Database.git

# 2. 执行SQL（按顺序）
psql yebailing_db -f db/schema_core_mvp.sql
psql yebailing_db -f db/data_init_mvp.sql
# ...

# 3. 如需导入数据，从source_data/获取Excel
python3 db/import_platform_data.py
```

### 数据备份

```bash
# 备份原始数据
tar -czf source_data_backup.tar.gz source_data/

# 备份数据库
pg_dump yebailing_db > db_backup.sql
```

---

## 八、后续建议

### 8.1 保持结构稳定
- ✅ 数据库文件统一放 `db/`
- ✅ 原始数据统一放 `source_data/`
- ✅ 文档统一放 `docs/`

### 8.2 命名规范
- SQL文件: `{功能}_{描述}.sql`
- Python脚本: `{动作}_{对象}.py`
- Excel文件: 保持原始文件名

### 8.3 定期清理
- 每月检查 `source_data/` 是否有过期文件
- 归档不再使用的验证JSON文件

---

## 九、变更记录

| 操作 | 文件数 | 说明 |
|-----|--------|------|
| 创建目录 | 2 | db/, source_data/ |
| 移动到db/ | 31 | 所有SQL、Python、JSON |
| 移动到source_data/ | 8 | 所有Excel、图片、数据目录 |
| 更新CLAUDE.md | 1 | 添加结构说明，更新索引 |
| 更新.gitignore | 1 | 简化排除规则 |
| **总计** | **43** | 43项操作 |

---

**重组完成时间**: 2025-11-25  
**符合全局记忆规则**: ✅ 是  
**项目结构**: 分层目录架构  
**维护状态**: 优秀
